<html>
  <head>
    <link rel="stylesheet" href="./app.css" />
  </head>

  <body>
    <script id="vertexShader" type="x-shader/x-vertex">
      uniform sampler2D voxelNormals;
      uniform float voxelCount;
      uniform vec3 sunColor;
      uniform vec3 lightDir;
      uniform vec3 ambient;
      attribute vec3 color;
      attribute uint voxelIndex;
      varying vec3 vColor;
      varying float vSunDif;
      varying float vSkyDif;

      #include <common>
      #include <fog_pars_vertex>
      #include <shadowmap_pars_vertex>

      void main() {
        vec2 uv = vec2(float(voxelIndex) / voxelCount, 0.5);
        vec3 nor = texture2D(voxelNormals, uv).xyz;
        vSunDif = clamp(dot(lightDir, nor), 0.0, 1.0);
        vSkyDif = sqrt(clamp(0.5 + 0.5 * dot(-nor, vec3(0.0, 1.0, 0.0)), 0.0, 1.0));

        vColor = color;

        #include <begin_vertex>
        #include <project_vertex>
        #include <worldpos_vertex>
        #include <beginnormal_vertex>
        #include <morphnormal_vertex>
        #include <skinbase_vertex>
        #include <skinnormal_vertex>
        #include <defaultnormal_vertex>
        #include <shadowmap_vertex>
        #include <fog_vertex>
      }
    </script>
    <script id="fragmentShader" type="x-shader/x-fragment">
      uniform vec3 sunColor;
      uniform vec3 ambient;

      varying vec3 vColor;
      varying float vSunDif;
      varying float vSkyDif;

      #include <common>
      #include <packing>
      #include <fog_pars_fragment>
      #include <bsdfs>
      #include <lights_pars_begin>
      #include <shadowmap_pars_fragment>
      #include <shadowmask_pars_fragment>

      void main() {
        vec3 lin = vec3(0.0);
        float shadow = getShadowMask();
        lin += vSunDif * sunColor * 0.8 * shadow;
        lin += vSkyDif * vec3(1.0, 1.40, 2.00);
        lin += ambient;

        vec3 color = vColor * lin;

        gl_FragColor = vec4(color, 1.0);
      }
    </script>
    <div id="root">
      <script src="./src/index.tsx"></script>
    </div>
  </body>
</html>
